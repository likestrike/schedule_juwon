<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <meta name="theme-color" content="#667eea" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="아이 계획표" />
    <meta name="mobile-web-app-capable" content="yes" />
    
    <!-- 캐싱 방지 메타 태그 -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    
    <title>아이 주간 계획표 v1.2</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Arial', sans-serif;
        background: #ffffff;
        min-height: 100vh;
        min-height: 100dvh;
        overflow-x: hidden;
        margin: 0;
        padding: 0;
        padding-top: env(safe-area-inset-top);
        padding-bottom: env(safe-area-inset-bottom);
        padding-left: env(safe-area-inset-left);
        padding-right: env(safe-area-inset-right);
      }

      .container {
        position: relative;
        width: 100%;
        height: 100vh;
        height: 100dvh;
        overflow: hidden;
        max-height: calc(100vh - env(keyboard-inset-height, 0px));
        max-height: calc(100dvh - env(keyboard-inset-height, 0px));
      }

      .schedule-wrapper {
        display: flex;
        width: 500%;
        height: 100%;
        transition: transform 0.3s ease-in-out;
      }

      .day-schedule {
        width: 20%;
        height: 100%;
        padding: 15px;
        padding-top: max(15px, env(safe-area-inset-top));
        padding-bottom: max(15px, env(safe-area-inset-bottom) + 80px);
        display: flex;
        flex-direction: column;
        box-sizing: border-box;
      }

      .day-header {
        background: rgba(0, 0, 0, 0.8);
        border-radius: 15px;
        padding: 12px;
        margin-bottom: 15px;
        text-align: center;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(10px);
        flex-shrink: 0;
      }

      .day-title {
        font-size: 22px;
        font-weight: bold;
        color: #ffffff;
        margin-bottom: 4px;
      }

      .day-subtitle {
        font-size: 13px;
        color: #e0e0e0;
      }

      .schedule-list {
        flex: 1;
        overflow-y: auto;
        padding-right: 8px;
        overscroll-behavior: contain;
        -webkit-overflow-scrolling: touch;
      }

      .schedule-item {
        background: #f8f9fa;
        border-radius: 12px;
        padding: 12px;
        margin-bottom: 8px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        backdrop-filter: blur(5px);
        transition: transform 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: space-between;
        width: 100%;
        border: 1px solid #e9ecef;
      }

      .schedule-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
      }

      .time {
        flex: 0 0 40%;
        font-size: 14px;
        color: #495057;
        font-weight: bold;
        text-align: left;
        padding-right: 8px;
      }

      .activity {
        flex: 0 0 60%;
        font-size: 15px;
        color: #212529;
        font-weight: 500;
        text-align: left;
        padding-left: 8px;
      }

      .navigation {
        position: fixed;
        bottom: max(15px, env(safe-area-inset-bottom) + 15px);
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 8px;
        z-index: 100;
      }

      .nav-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: rgba(0, 0, 0, 0.3);
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .nav-dot.active {
        background: #000000;
        transform: scale(1.2);
      }

      .nav-button {
        position: fixed;
        bottom: max(70px, env(safe-area-inset-bottom) + 70px);
        width: 45px;
        height: 45px;
        border-radius: 50%;
        background: rgba(0, 0, 0, 0.7);
        border: none;
        font-size: 16px;
        color: #ffffff;
        cursor: pointer;
        z-index: 1000;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        backdrop-filter: blur(10px);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        touch-action: manipulation;
        user-select: none;
      }

      .nav-button:hover {
        background: rgba(0, 0, 0, 0.8);
        transform: scale(1.1);
      }

      .nav-button:active {
        transform: scale(0.95);
      }

      .nav-button-left {
        left: max(15px, env(safe-area-inset-left) + 15px);
      }

      .nav-button-right {
        right: max(15px, env(safe-area-inset-right) + 15px);
      }

      .loading {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        color: #333333;
        font-size: 18px;
      }

      .error {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        color: #dc3545;
        font-size: 16px;
        text-align: center;
        padding: 20px;
      }

      /* 풀스크린 모드를 위한 추가 스타일 */
      @media (display-mode: fullscreen) {
        .container {
          height: 100vh;
          height: 100dvh;
        }
      }

      @media (display-mode: standalone) {
        .container {
          height: 100vh;
          height: 100dvh;
        }
      }

      /* 작은 화면 최적화 */
      @media (max-height: 600px) {
        .day-header {
          padding: 8px;
          margin-bottom: 10px;
        }

        .day-title {
          font-size: 18px;
        }

        .day-subtitle {
          font-size: 11px;
        }

        .schedule-item {
          padding: 8px 10px;
          margin-bottom: 6px;
        }

        .time {
          font-size: 11px;
        }

        .activity {
          font-size: 13px;
        }
      }

      .schedule-list::-webkit-scrollbar {
        width: 4px;
      }

      .schedule-list::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.1);
        border-radius: 2px;
      }

      .schedule-list::-webkit-scrollbar-thumb {
        background: rgba(0, 0, 0, 0.3);
        border-radius: 2px;
      }

      /* 현재 시간 하이라이트 */
      .current-time {
        background: linear-gradient(135deg, #ff6b6b, #ee5a5a) !important;
        border: 3px solid #ff4757 !important;
        box-shadow: 0 8px 30px rgba(255, 71, 87, 0.4) !important;
      }

      .current-time .time {
        color: #000 !important;
        font-weight: bold;
      }

      .current-time .activity {
        color: #000 !important;
        font-weight: bold;
      }

      @keyframes pulse {
        0% {
          box-shadow: 0 8px 30px rgba(255, 71, 87, 0.4);
        }
        50% {
          box-shadow: 0 12px 35px rgba(255, 71, 87, 0.6);
          transform: scale(1.08);
        }
        100% {
          box-shadow: 0 8px 30px rgba(255, 71, 87, 0.4);
        }
      }

      /* 오전/오후 시간대별 색상 및 활동별 색상 */
      .morning {
        background: linear-gradient(135deg, #e3f2fd, #bbdefb) !important;
      }

      .afternoon {
        background: linear-gradient(135deg, #fff3e0, #ffcc80) !important;
      }

      .evening {
        background: linear-gradient(135deg, #fce4ec, #f8bbd9) !important;
      }

      /* 특별 활동 색상 */
      .meal {
        background: linear-gradient(135deg, #ffd93d, #ff9671) !important;
      }
      
      .free {
        background: linear-gradient(135deg, #74b9ff, #0984e3) !important;
        color: white !important;
      }

      .free .time {
        color: #ffffff !important;
      }

      .free .activity {
        color: #ffffff !important;
      }
    </style>
  </head>
  <body>
    <div class="loading" id="loading">데이터를 불러오는 중...</div>
    <div class="error" id="error" style="display: none;">
      데이터를 불러올 수 없습니다.<br>
      schedule_data.json 파일을 확인해주세요.
    </div>

    <div class="container" id="container" style="display: none;">
      <div class="schedule-wrapper" id="scheduleWrapper">
        <!-- 동적으로 생성될 스케줄 내용 -->
      </div>

      <button class="nav-button nav-button-left" id="prevBtn">←</button>
      <button class="nav-button nav-button-right" id="nextBtn">→</button>

      <div class="navigation" id="navigation">
        <!-- 동적으로 생성될 네비게이션 점들 -->
      </div>
    </div>

    <script>
      let currentDay = 0;
      let totalDays = 0;
      let scheduleData = null;
      const wrapper = document.getElementById('scheduleWrapper');
      const container = document.getElementById('container');
      const loading = document.getElementById('loading');
      const error = document.getElementById('error');

      // 스케줄 데이터 (JSON 데이터를 직접 포함)
      const SCHEDULE_DATA = {
        "schedules": {
          "monday": {
            "title": "월요일",
            "subtitle": "새로운 한 주의 시작!",
            "items": [
              { "time": "05:00-06:00", "activity": "🌅 기상 후 홈런", "type": "study" },
              { "time": "06:00-06:30", "activity": "🍽️ 아침식사", "type": "meal" },
              { "time": "06:30-07:00", "activity": "🚿 씻기", "type": "normal" },
              { "time": "07:00-07:30", "activity": "📚 공부", "type": "study" },
              { "time": "07:30-08:00", "activity": "📖 독서", "type": "normal" },
              { "time": "08:00-08:30", "activity": "😌 휴식", "type": "normal" },
              { "time": "08:30-09:00", "activity": "🏃‍♂️ 운동", "type": "exercise" },
              { "time": "09:00-10:00", "activity": "🎯 자유시간", "type": "free" },
              { "time": "10:00-10:30", "activity": "📝 영어문법교재", "type": "study" },
              { "time": "10:30-12:00", "activity": "🎬 영화감상", "type": "normal" },
              { "time": "12:00-13:00", "activity": "🍱 점심, 간식", "type": "meal" },
              { "time": "13:00-13:30", "activity": "📖 독서", "type": "normal" },
              { "time": "13:30-15:00", "activity": "🎯 자유시간", "type": "free" },
              { "time": "15:00-15:30", "activity": "📞 홈런상담", "type": "normal" },
              { "time": "15:30-17:00", "activity": "🇺🇸 송글리시", "type": "study" },
              { "time": "17:00-17:30", "activity": "✏️ 숙제하기", "type": "study" },
              { "time": "17:30-18:30", "activity": "🎮 게임", "type": "normal" },
              { "time": "18:30-20:00", "activity": "🍽️ 저녁식사, 씻기", "type": "meal" },
              { "time": "20:00-05:00", "activity": "😴 수면", "type": "sleep" }
            ]
          },
          "tuesday": {
            "title": "화요일",
            "subtitle": "힘찬 하루!",
            "items": [
              { "time": "05:00-06:00", "activity": "🌅 기상 후 홈런", "type": "study" },
              { "time": "06:00-06:30", "activity": "🍽️ 아침식사", "type": "meal" },
              { "time": "06:30-07:00", "activity": "🚿 씻기", "type": "normal" },
              { "time": "07:00-07:30", "activity": "📚 공부", "type": "study" },
              { "time": "07:30-08:00", "activity": "📖 독서", "type": "normal" },
              { "time": "08:00-08:30", "activity": "😌 휴식", "type": "normal" },
              { "time": "08:30-09:00", "activity": "🏃‍♂️ 운동", "type": "exercise" },
              { "time": "09:00-10:30", "activity": "🎯 자유시간", "type": "free" },
              { "time": "10:30-11:30", "activity": "🎮 게임", "type": "normal" },
              { "time": "11:30-12:00", "activity": "🍱 라즈키즈", "type": "study" },
              { "time": "12:00-13:00", "activity": "🍱 점심, 간식", "type": "meal" },
              { "time": "13:00-15:00", "activity": "🎯 자유시간", "type": "free" },
              { "time": "15:00-16:00", "activity": "🎨 미술", "type": "normal" },
              { "time": "16:00-16:30", "activity": "📖 독서", "type": "normal" },
              { "time": "16:30-20:00", "activity": "🍽️ 저녁식사, 씻기", "type": "meal" },
              { "time": "20:00-05:00", "activity": "😴 수면", "type": "sleep" }
            ]
          },
          "wednesday": {
            "title": "수요일",
            "subtitle": "중간점 파이팅!",
            "items": [
              { "time": "05:00-06:00", "activity": "🌅 기상 후 홈런", "type": "study" },
              { "time": "06:00-06:30", "activity": "🍽️ 아침식사", "type": "meal" },
              { "time": "06:30-07:00", "activity": "🚿 씻기", "type": "normal" },
              { "time": "07:00-07:30", "activity": "📚 공부", "type": "study" },
              { "time": "07:30-08:00", "activity": "📖 독서", "type": "normal" },
              { "time": "08:00-08:30", "activity": "😌 휴식", "type": "normal" },
              { "time": "08:30-09:00", "activity": "🏃‍♂️ 운동", "type": "exercise" },
              { "time": "09:00-10:00", "activity": "🎯 자유시간", "type": "free" },
              { "time": "10:00-10:30", "activity": "📚 영어책제작", "type": "study" },
              { "time": "10:30-11:30", "activity": "🎈 엔트리", "type": "normal" },
              { "time": "11:30-12:00", "activity": "😌 휴식", "type": "normal" },
              { "time": "12:00-13:00", "activity": "🍱 점심, 간식", "type": "meal" },
              { "time": "13:00-15:30", "activity": "🎯 자유시간", "type": "free" },
              { "time": "15:30-17:00", "activity": "🇺🇸 송글리시", "type": "study" },
              { "time": "17:00-17:30", "activity": "✏️ 숙제하기", "type": "study" },
              { "time": "17:30-18:30", "activity": "🎮 게임", "type": "normal" },
              { "time": "18:30-20:00", "activity": "🍽️ 저녁식사, 씻기", "type": "meal" },
              { "time": "20:00-05:00", "activity": "😴 수면", "type": "sleep" }
            ]
          },
          "thursday": {
            "title": "목요일",
            "subtitle": "거의 다 왔어!",
            "items": [
              { "time": "05:00-06:00", "activity": "🌅 기상 후 홈런", "type": "study" },
              { "time": "06:00-06:30", "activity": "🍽️ 아침식사", "type": "meal" },
              { "time": "06:30-07:00", "activity": "🚿 씻기", "type": "normal" },
              { "time": "07:00-07:30", "activity": "📚 공부", "type": "study" },
              { "time": "07:30-08:00", "activity": "📖 독서", "type": "normal" },
              { "time": "08:00-08:30", "activity": "😌 휴식", "type": "normal" },
              { "time": "08:30-09:00", "activity": "🏃‍♂️ 운동", "type": "exercise" },
              { "time": "09:00-10:30", "activity": "🎯 자유시간", "type": "free" },
              { "time": "10:30-11:30", "activity": "🎈 엔트리", "type": "normal" },
              { "time": "11:30-12:00", "activity": "😌 휴식", "type": "normal" },
              { "time": "12:00-13:00", "activity": "🍱 점심, 간식", "type": "meal" },
              { "time": "13:00-14:00", "activity": "🍱 라즈키즈&휴식", "type": "study" },
              { "time": "14:00-14:30", "activity": "🏠 본격! 아파트탐방", "type": "normal" },
              { "time": "14:30-16:00", "activity": "🎯 자유시간", "type": "free" },
              { "time": "16:20-17:20", "activity": "🎮 게임", "type": "normal" },
              { "time": "17:20-18:00", "activity": "🎈 놀기", "type": "free" },
              { "time": "18:00-19:00", "activity": "🧠 싱크빅", "type": "study" },
              { "time": "19:00-20:00", "activity": "🍽️ 저녁식사, 씻기", "type": "meal" },
              { "time": "20:00-05:00", "activity": "😴 수면", "type": "sleep" }
            ]
          },
          "friday": {
            "title": "금요일",
            "subtitle": "주말이 왔어요! 🎉",
            "items": [
              { "time": "05:00-06:00", "activity": "🌅 기상 후 홈런", "type": "study" },
              { "time": "06:00-06:30", "activity": "🍽️ 아침식사", "type": "meal" },
              { "time": "06:30-07:00", "activity": "🚿 씻기", "type": "normal" },
              { "time": "07:00-07:30", "activity": "📚 공부", "type": "study" },
              { "time": "07:30-08:00", "activity": "📖 독서", "type": "normal" },
              { "time": "08:00-08:30", "activity": "😌 휴식", "type": "normal" },
              { "time": "08:30-09:00", "activity": "🏃‍♂️ 운동", "type": "exercise" },
              { "time": "09:00-10:00", "activity": "🎯 자유시간", "type": "free" },
              { "time": "10:00-10:30", "activity": "📚 영어책 제작", "type": "study" },
              { "time": "10:30-11:30", "activity": "🎈 엔트리", "type": "normal" },
              { "time": "11:30-12:00", "activity": "😌 휴식", "type": "normal" },
              { "time": "12:00-13:00", "activity": "🍱 점심, 간식", "type": "meal" },
              { "time": "13:30-15:30", "activity": "📚 한우리", "type": "study" },
              { "time": "15:30-17:00", "activity": "🇺🇸 송글리시", "type": "study" },
              { "time": "17:00-17:30", "activity": "✏️ 숙제하기", "type": "study" },
              { "time": "17:30-18:30", "activity": "🎮 게임", "type": "normal" },
              { "time": "18:30-20:00", "activity": "🍽️ 저녁식사, 씻기", "type": "meal" },
              { "time": "20:00-05:00", "activity": "😴 수면", "type": "sleep" }
            ]
          }
        }
      };

      // 데이터 로드 함수 (이제 내장 데이터 사용)
      function loadScheduleData() {
        try {
          scheduleData = SCHEDULE_DATA;
          
          // 스케줄 생성
          generateSchedule();
          
          // UI 표시
          loading.style.display = 'none';
          container.style.display = 'block';
          
          // 초기화
          initializeApp();
        } catch (err) {
          console.error('Error loading schedule data:', err);
          loading.style.display = 'none';
          error.style.display = 'flex';
        }
      }

      // 스케줄 HTML 생성
      function generateSchedule() {
        const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday'];
        totalDays = days.length;

        // 기존 내용 초기화
        wrapper.innerHTML = '';

        days.forEach((dayKey, index) => {
          const dayData = scheduleData.schedules[dayKey];
          
          // 일일 스케줄 컨테이너 생성
          const daySchedule = document.createElement('div');
          daySchedule.className = 'day-schedule';

          // 헤더 생성
          const dayHeader = document.createElement('div');
          dayHeader.className = 'day-header';
          dayHeader.innerHTML = `
            <div class="day-title">${dayData.title}</div>
            <div class="day-subtitle">${dayData.subtitle}</div>
          `;

          // 스케줄 리스트 생성
          const scheduleList = document.createElement('div');
          scheduleList.className = 'schedule-list';

          // 각 스케줄 항목 생성
          dayData.items.forEach(item => {
            const scheduleItem = document.createElement('div');
            
            // 시간대별 클래스 추가
            let timeClass = '';
            const timeStart = item.time.split('-')[0];
            const hour = parseInt(timeStart.split(':')[0]);
            
            if (hour >= 5 && hour < 12) {
              timeClass = 'morning';
            } else if (hour >= 12 && hour < 18) {
              timeClass = 'afternoon';
            } else {
              timeClass = 'evening';
            }
            
            // 활동별 클래스도 유지 (식사, 자유시간은 우선)
            let activityClass = item.type;
            if (item.type === 'meal' || item.type === 'free') {
              scheduleItem.className = `schedule-item ${activityClass}`;
            } else {
              scheduleItem.className = `schedule-item ${timeClass}`;
            }
            
            // 시간 형식 변환 (05:00-06:00 -> 05:00 - 06:00)
            const formattedTime = item.time.replace('-', ' - ');
            
            scheduleItem.innerHTML = `
              <div class="time">${formattedTime}</div>
              <div class="activity">${item.activity}</div>
            `;

            scheduleList.appendChild(scheduleItem);
          });

          daySchedule.appendChild(dayHeader);
          daySchedule.appendChild(scheduleList);
          wrapper.appendChild(daySchedule);
        });

        // 네비게이션 점들 생성
        generateNavigation();
      }

      // 네비게이션 점 생성
      function generateNavigation() {
        const navigation = document.getElementById('navigation');
        navigation.innerHTML = '';

        for (let i = 0; i < totalDays; i++) {
          const navDot = document.createElement('div');
          navDot.className = i === 0 ? 'nav-dot active' : 'nav-dot';
          navDot.setAttribute('data-day', i);
          navDot.addEventListener('click', () => goToDay(i));
          navigation.appendChild(navDot);
        }
      }

      // 앱 초기화
      function initializeApp() {
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');

        // 네비게이션 버튼 이벤트
        prevBtn.addEventListener('click', () => {
          goToDay(currentDay - 1);
        });

        nextBtn.addEventListener('click', () => {
          goToDay(currentDay + 1);
        });

        // 터치/마우스 이벤트 설정
        setupTouchEvents();

        // 키보드 네비게이션
        document.addEventListener('keydown', (e) => {
          if (e.key === 'ArrowLeft') {
            goToDay(currentDay - 1);
          } else if (e.key === 'ArrowRight') {
            goToDay(currentDay + 1);
          }
        });

        // 현재 시간 하이라이트
        highlightCurrentTime();
        setInterval(highlightCurrentTime, 60000);

        // 뷰포트 높이 동적 조정
        setDynamicViewport();
        window.addEventListener('resize', setDynamicViewport);
        window.addEventListener('orientationchange', setDynamicViewport);

        // 현재 시간으로 스크롤
        setTimeout(scrollToCurrentTime, 2000);
      }

      // 터치/마우스 이벤트 설정
      function setupTouchEvents() {
        let startX = 0;
        let startY = 0;
        let currentX = 0;
        let currentY = 0;
        let isDragging = false;
        let isVerticalScroll = false;

        // 터치 이벤트
        wrapper.addEventListener('touchstart', (e) => {
          startX = e.touches[0].clientX;
          startY = e.touches[0].clientY;
          isDragging = true;
          isVerticalScroll = false;
          wrapper.style.transition = 'none';
        }, { passive: true });

        wrapper.addEventListener('touchmove', (e) => {
          if (!isDragging) return;
          
          currentX = e.touches[0].clientX;
          currentY = e.touches[0].clientY;
          
          const deltaX = currentX - startX;
          const deltaY = currentY - startY;
          
          // 세로 스크롤인지 가로 스와이프인지 판단
          if (!isVerticalScroll && Math.abs(deltaY) > Math.abs(deltaX)) {
            // 세로 스크롤로 판단되면 가로 스와이프 비활성화
            isVerticalScroll = true;
            return;
          } else if (!isVerticalScroll && Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > 10) {
            // 가로 스와이프로 판단되면 세로 스크롤 방지
            e.preventDefault();
            const currentTransform = -currentDay * 20;
            wrapper.style.transform = `translateX(${currentTransform + (deltaX / window.innerWidth) * 20}%)`;
          }
        }, { passive: false });

        wrapper.addEventListener('touchend', (e) => {
          if (!isDragging) return;
          isDragging = false;
          wrapper.style.transition = 'transform 0.3s ease-in-out';

          // 세로 스크롤이었다면 가로 이동 처리하지 않음
          if (isVerticalScroll) {
            goToDay(currentDay);
            return;
          }

          const deltaX = currentX - startX;
          const threshold = 50;

          if (Math.abs(deltaX) > threshold) {
            if (deltaX > 0) {
              goToDay(currentDay - 1);
            } else {
              goToDay(currentDay + 1);
            }
          } else {
            goToDay(currentDay);
          }
        }, { passive: true });

        // 마우스 이벤트 (데스크톱용)
        wrapper.addEventListener('mousedown', (e) => {
          startX = e.clientX;
          startY = e.clientY;
          isDragging = true;
          isVerticalScroll = false;
          wrapper.style.transition = 'none';
          e.preventDefault();
        });

        document.addEventListener('mousemove', (e) => {
          if (!isDragging) return;
          
          currentX = e.clientX;
          currentY = e.clientY;
          
          const deltaX = currentX - startX;
          const deltaY = currentY - startY;
          
          // 마우스는 가로 드래그만 허용
          if (Math.abs(deltaX) > Math.abs(deltaY)) {
            const currentTransform = -currentDay * 20;
            wrapper.style.transform = `translateX(${currentTransform + (deltaX / window.innerWidth) * 20}%)`;
          }
        });

        document.addEventListener('mouseup', (e) => {
          if (!isDragging) return;
          isDragging = false;
          wrapper.style.transition = 'transform 0.3s ease-in-out';

          const deltaX = currentX - startX;
          const threshold = 50;

          if (Math.abs(deltaX) > threshold) {
            if (deltaX > 0) {
              goToDay(currentDay - 1);
            } else {
              goToDay(currentDay + 1);
            }
          } else {
            goToDay(currentDay);
          }
        });
      }

      function goToDay(dayIndex) {
        // 루프 처리
        if (dayIndex < 0) {
          currentDay = totalDays - 1;
        } else if (dayIndex >= totalDays) {
          currentDay = 0;
        } else {
          currentDay = dayIndex;
        }

        wrapper.style.transform = `translateX(-${currentDay * 20}%)`;
        wrapper.style.transition = 'transform 0.3s ease-in-out';
        updateNavigation();
      }

      function updateNavigation() {
        const navDots = document.querySelectorAll('.nav-dot');
        navDots.forEach((dot, index) => {
          dot.classList.toggle('active', index === currentDay);
        });
      }

      // 현재 시간에 따른 하이라이트
      function highlightCurrentTime() {
        const now = new Date();
        const currentHour = now.getHours();
        const currentMinute = now.getMinutes();
        const currentTime = currentHour * 60 + currentMinute;

        // 모든 스케줄 항목에서 현재 시간 클래스 제거
        document.querySelectorAll('.current-time').forEach((item) => {
          item.classList.remove('current-time');
        });

        // 현재 요일의 스케줄 항목들 확인
        const currentDaySchedule = document.querySelectorAll('.day-schedule')[currentDay];
        if (!currentDaySchedule) return;

        const scheduleItems = currentDaySchedule.querySelectorAll('.schedule-item');

        scheduleItems.forEach((item) => {
          const timeText = item.querySelector('.time').textContent;
          const [startTime, endTime] = timeText.split(' - ');

          const [startHour, startMin] = startTime.split(':').map(Number);
          const [endHour, endMin] = endTime.split(':').map(Number);

          let startMinutes = startHour * 60 + startMin;
          let endMinutes = endHour * 60 + endMin;

          // 다음 날로 넘어가는 경우 처리 (수면시간 등)
          if (endMinutes < startMinutes) {
            endMinutes += 24 * 60;
          }

          if (currentTime >= startMinutes && currentTime < endMinutes) {
            item.classList.add('current-time');
          }
        });
      }

      // 뷰포트 높이 동적 조정
      function setDynamicViewport() {
        const vh = window.innerHeight * 0.01;
        document.documentElement.style.setProperty('--vh', `${vh}px`);
      }

      // 자동 스크롤 (현재 시간 항목으로)
      function scrollToCurrentTime() {
        const currentTimeItem = document.querySelector('.current-time');
        if (currentTimeItem) {
          currentTimeItem.scrollIntoView({
            behavior: 'smooth',
            block: 'center',
          });
        }
      }

      // 페이지 로드 시 데이터 로드
      document.addEventListener('DOMContentLoaded', loadScheduleData);
    </script>
  </body>
</html>
